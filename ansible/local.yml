- hosts: localhost
  become: true
  vars:
    - user_repositories: "{{ lookup('env', 'USER_REPOSITORIES') }}"
    - include: tasks/macos/brew_packages.yml
    - include: tasks/macos/cask_packages.yml

  pre_tasks:
    - name: update repositories
      apt: update_cache=yes
      become_user: root
      changed_when: False
      when: ansible_distribution == "Ubuntu"

    - name: Ensuring Homebrew Is Installed
      stat:
        path: /usr/local/bin/brew
      register: homebrew_check
      when: ansible_distribution == "MacOSX"

    # - name: Fail If Homebrew Is Not Installed and install_homebrew_if_missing Is False
    #   fail:
    #     msg: Homebrew is missing...Install from http://brew.sh/
    #   when:
    #     - not homebrew_check.stat.exists
    #     - not install_homebrew_if_missing
    #     - ansible_distribution == "MacOSX"
    #
    # - name: Installing Homebrew
    #   shell: /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    #   when:
    #     - not homebrew_check.stat.exists
    #     - install_homebrew_if_missing
    #     - ansible_distribution == "MacOSX"

#https://medium.com/espinola-designs/manage-your-dotfiles-with-ansible-6dbedd5532bb


  tasks:
    # common
    # programming languages
    - include: tasks/common/programming_languages/go.yml
    - include: tasks/common/programming_languages/node.yml
    - include: tasks/common/programming_languages/rust.yml
    # repositories
    # - include: tasks/common/repositories/self.yml
    # - include: tasks/common/repositories/tpm.yml
    # - include: tasks/common/repositories/fzf.yml
    # software
    # - include: tasks/common/software/kitty.yml
    # - include: tasks/common/software/nvm.yml
    # - include: tasks/common/software/ohmyzsh.yml

    # ubuntu
    # - include: tasks/ubuntu/utils.yml
    # - include: tasks/ubuntu/nvim.yml
    # - include: tasks/ubuntu/docker.yml
    # - include: tasks/ubuntu/software.yml

    # macos

  handlers:
    - include: handlers/docker.yml
